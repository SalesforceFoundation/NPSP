<template>
    <lightning-layout vertical-align='center' multiple-rows='true'>

        <lightning-layout-item size='12' padding='horizontal-small'>
            <article class='credit-card-container slds-var-m-top_small'>

                <lightning-layout vertical-align='center' multiple-rows='true'>

                    <lightning-layout-item size='12'>
                        <div class='credit-card-header slds-var-p-vertical_small slds-var-p-horizontal_x-small'>
                            <lightning-layout vertical-align='center'>
                                <lightning-layout-item size='6'>
                                    <h1 class='slds-text-body_regular' data-qa-locator='heading'>{labels.elevateWidgetLabel}</h1>
                                </lightning-layout-item>
                                <lightning-layout-item size='6'>
                                    <template if:true={isEditMode}>
                                        <template if:true={isDisabled}>
                                            <lightning-button variant="base"
                                                label={labels.updatePaymentButtonLabel}
                                                onclick={handleUserEnabledWidget}
                                                class='slds-button slds-float_right hide-card-button'
                                                data-qa-locator='button Update Payment Information'>
                                            </lightning-button>
                                        </template>
                                        <template if:false={isDisabled}>
                                            <template if:false={updatePaymentMode}>
                                                <lightning-button variant="base"
                                                    label={labels.cancelButtonLabel}
                                                    icon-name='utility:close'
                                                    icon-position="right"
                                                    onclick={handleUserCancelledWidget}
                                                    class='slds-button slds-float_right hide-card-button'
                                                    data-qa-locator='button Cancel Update Payment Information'>
                                                </lightning-button>
                                            </template>
                                        </template>
                                    </template>
                                    <template if:false={isEditMode}>
                                        <template if:false={isDisabled}>
                                            <template if:false={updatePaymentMode}>
                                                <lightning-button variant="base"
                                                    label={labels.elevateDisableButtonLabel}
                                                    icon-name='utility:close'
                                                    icon-position="right"
                                                    onclick={handleUserDisabledWidget}
                                                    class='slds-button slds-float_right hide-card-button'
                                                    data-qa-locator='button Do Not Use Elevate'>
                                                </lightning-button>
                                            </template>
                                        </template>
                                    </template>
                                </lightning-layout-item>
                            </lightning-layout>
                        </div>
                    </lightning-layout-item>

                    <lightning-layout-item size="12" class='slds-var-p-horizontal_small slds-var-p-top_small'>
                        <template if:true={isDisabled}>
                            <template if:true={showExistingCardInfo}>
                                <lightning-layout vertical-align='center' multiple-rows='true'>
                                    <lightning-layout-item size="4" class=" slds-text-color_weak slds-var-p-bottom_small">
                                        <label for="last4CreditCard" id="creditCardLast4Label"
                                            class="slds-form-element__label slds-text-body_regular slds-text-color_default slds-p-vertical_none slds-m-bottom_x-small">
                                            {cardLastFourLabel}
                                        </label><br/>
                                        <lightning-formatted-text
                                            id="last4CreditCard"
                                            value={rd2State.cardLastFour}
                                            data-qa-locator={qaLocatorLastFourDigits}
                                            aria-labelledby="creditCardLast4Label">
                                        </lightning-formatted-text>
                                    </lightning-layout-item>
                                    <lightning-layout-item size="4" class="slds-text-color_weak slds-var-p-bottom_small">
                                        <label for="expirationDate" id="expirationDateLabel"
                                            class="slds-form-element__label slds-text-body_regular slds-text-color_default slds-p-vertical_none slds-m-bottom_x-small">
                                            {labels.commonExpirationDate}
                                        </label><br/>
                                        <lightning-formatted-text id="expirationDate"
                                            value={cardExpDate}
                                            data-qa-locator={qaLocatorExpirationDate}
                                            aria-labelledby="expirationDateLabel">
                                        </lightning-formatted-text>
                                    </lightning-layout-item>
                                </lightning-layout>
                            </template>
                            <template if:true={showExistingACHInfo}>
                                <lightning-layout vertical-align='center' multiple-rows='true'>
                                    <lightning-layout-item size="4" class=" slds-text-color_weak slds-var-p-bottom_small">
                                        <label for="last4ACH"
                                               class="slds-form-element__label slds-text-body_regular slds-text-color_default slds-p-vertical_none slds-m-bottom_x-small">
                                            {achLastFourLabel}
                                        </label><br/>
                                        <lightning-formatted-text
                                                id="last4ACH"
                                                value={rd2State.achLastFour}
                                                data-qa-locator={qaLocatorLastFourDigits}>
                                        </lightning-formatted-text>
                                    </lightning-layout-item>
                                </lightning-layout>
                            </template>
                            <template if:false={isEditMode}>
                                <p class='fade-in'>
                                    <span class='slds-content-message'>
                                        <lightning-formatted-rich-text value={labels.elevateDisabledMessage}
                                            data-qa-locator="richtext Elevate Disabled Message">
                                        </lightning-formatted-rich-text>
                                    </span>
                                    <lightning-button variant='base' label={labels.elevateEnableButtonLabel}
                                        title={labels.elevateEnableButtonLabel} onclick={handleUserEnabledWidget}
                                        class='slds-var-m-left_xx-small' data-qa-locator='button Use Elevate Now'>
                                    </lightning-button>
                                </p>
                            </template>
                        </template>

                        <template if:false={isDisabled}>
                            <div if:true={alert.show} class='slds-var-p-bottom_medium'>
                                <c-util-alert-banner if:true={alert.show} theme={alert.theme} variant={alert.variant}
                                                     icon={alert.icon} message={alert.message} data-qa-locator='alert Message'>
                                </c-util-alert-banner>
                            </div>
                            <template if:true={updatePaymentMode}>
                                <div class="slds-var-p-bottom_medium">
                                    <c-formatted-text-with-date value={nextPaymentDateMessage} date={nextDonationDate}></c-formatted-text-with-date>
                                </div>
                            </template>
                            <template if:true={currentPaymentIsCard}>
                                <div class="slds-grid">
                                    <div class="slds-col slds-size_1-of-2">
                                        <lightning-input onchange={handleFieldChange}
                                                         name="cardholderName" label={labels.cardholderNameLabel}
                                                         data-qa-locator="input Elevate Cardholder Name" data-id="cardholderName">
                                        </lightning-input>
                                    </div>
                                </div>
                            </template>

                            <div class='iframe-container' data-qa-locator='iframe Elevate'>
                                <template if:true={isLoading}>
                                    <lightning-spinner alternative-text={labels.spinnerAltText}>
                                    </lightning-spinner>
                                </template>
                                <iframe class='payment-services-iframe' title={labels.elevateWidgetLabel}
                                        src={tokenizeCardPageUrl} data-id={labels.elevateWidgetLabel}>
                                </iframe>
                            </div>

                            <template if:true={currentPaymentIsCard}>
                                <div class="slds-grid">
                                    <div class="slds-col slds-size_1-of-1">
                                        <template if:false={showBillingAddress}>
                                            <lightning-button label={labels.addBillingAddressButtonLabel}
                                                            variant="base"
                                                            onclick={handleAddBillingAddressFields}
                                                            class="slds-button slds-var-m-bottom_small"
                                                            disabled={searchingForAddress}
                                                            data-qa-locator='button Clear Address'>
                                            </lightning-button>
                                        </template>
                                    </div>
                                </div>
                                <template if:true={showBillingAddress}>
                                    <div class="slds-grid slds-wrap slds-gutters slds-var-p-bottom_medium">
                                        <div class="slds-col slds-size_1-of-1 slds-var-p-horizontal_x-small">
                                            <strong class="slds-form-element__label slds-var-p-bottom_x-small">
                                                {billingAddressLabel}
                                            </strong>
                                            <lightning-helptext class="slds-clearfix" 
                                                content={labels.billingAddressHelpLabel}>
                                            </lightning-helptext>
                                            <lightning-button label={labels.useDonorAddressLabel}
                                                            onclick={handleDefaultAddressButton}
                                                            class="slds-button"
                                                            disabled={searchingForAddress}
                                                            data-qa-locator='button Use Donor Address'>
                                            </lightning-button>
                                            <lightning-button label={labels.clearAddressLabel}
                                                            variant="base"
                                                            onclick={handleClearAddressButton}
                                                            class="slds-button"
                                                            disabled={searchingForAddress}
                                                            data-qa-locator='button Clear Address'>
                                            </lightning-button>
                                            <lightning-button label={labels.removeBillingAddressButtonLabel}
                                                            variant="base"
                                                            onclick={handleRemoveBillingAddressFields}
                                                            class="slds-button slds-float_right"
                                                            disabled={searchingForAddress}
                                                            data-qa-locator='button Clear Address'>
                                                </lightning-button>
                                            <template if:true={showEmptyAddressError}>
                                                <div class="slds-text-color_error slds-var-p-top_small">
                                                    {labels.donorAddressEmptyLabel}
                                                </div>
                                            </template>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2 slds-var-p-around_x-small">
                                            <lightning-input onchange={handleFieldChange} value={billingStreet1}
                                                            name="billingStreet1" label={billingStreetLabel1}
                                                            data-qa-locator="input Elevate Billing Street 1" data-id="billingStreet1">
                                            </lightning-input>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2 slds-var-p-around_x-small">
                                            <lightning-input onchange={handleFieldChange} value={billingStreet2}
                                                            name="billingStreet2" label={billingStreetLabel2}
                                                            data-qa-locator="input Elevate Billing Street 2" data-id="billingStreet2">
                                            </lightning-input>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2 slds-var-p-around_x-small">
                                            <lightning-input onchange={handleFieldChange} value={billingCity}
                                                            name="billingCity" label={labels.billingCityLabel}
                                                            data-qa-locator="input Elevate Billing City" data-id="billingCity">
                                            </lightning-input>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2 slds-var-p-around_x-small">
                                            <lightning-input onchange={handleFieldChange} value={billingState}
                                                            name="billingState" label={labels.billingStateLabel}
                                                            data-qa-locator="input Elevate Billing State" data-id="billingState">
                                            </lightning-input>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2 slds-var-p-around_x-small">
                                            <lightning-input onchange={handleFieldChange} value={billingPostalCode}
                                                            name="billingPostalCode" label={labels.billingPostalCodeLabel}
                                                            data-qa-locator="input Elevate Billing Postal Code" data-id="billingPostalCode">
                                            </lightning-input>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2 slds-var-p-around_x-small">
                                            <lightning-input onchange={handleFieldChange} value={billingCountry}
                                                            name="billingCountry" label={labels.billingCountryLabel}
                                                            data-qa-locator="input Elevate Billing Country" data-id="billingCountry">
                                            </lightning-input>
                                        </div>
                                    </div>
                                </template>
                            </template>
                        </template>
                    </lightning-layout-item>

                </lightning-layout>
            </article>
        </lightning-layout-item>

    </lightning-layout>
</template>
