<template>
    <div id="containerDiv" onmousemove={handlemousemove} onmouseup={handlemouseup} ondblclick={handledblclickresizable} class={headerClass} onscroll={tableOuterDivScrolled}>
        <table
            class="slds-table slds-table_bordered slds-table_header-fixed slds-table_resizable-cols slds-max-medium-table_stacked" tabindex="0">
            <thead>
                <tr>
                    <th class={headClasses} scope="col" style={fixedWidth} tabindex="-1">
                        <div class="slds-cell-fixed" style={fixedWidth}>
                            <div class="slds-th__action slds-text-link--reset">
                                <span class="slds-truncate" title={labels.commonAmount}>{labels.commonAmount}</span>
                            </div>
                            <div class="slds-resizable">
                                <span class="slds-resizable__handle" onmousedown={handlemousedown}>
                                    <span class="slds-resizable__divider"></span>
                                </span>
                            </div>
                        </div>
                    </th>
                    <th class={headClasses} scope="col" style={fixedWidth} tabindex="-1">
                        <div class="slds-cell-fixed" style={fixedWidth}>
                            <div class="slds-th__action slds-text-link--reset">
                                <span class="slds-truncate" title={labels.RDCL_Frequency}>{labels.RDCL_Frequency}</span>
                            </div>
                            <div class="slds-resizable">
                                <span class="slds-resizable__handle" onmousedown={handlemousedown}>
                                    <span class="slds-resizable__divider"></span>
                                </span>
                            </div>
                        </div>
                    </th>
                    <th class={headClasses} scope="col" style={fixedWidth} tabindex="-1">
                        <div class="slds-cell-fixed" style={fixedWidth}>
                            <div class="slds-th__action slds-text-link--reset">
                                <span class="slds-truncate" title={paymentMethod}>{paymentMethod}</span>
                            </div>
                            <div class="slds-resizable">
                                <span class="slds-resizable__handle" onmousedown={handlemousedown}>
                                    <span class="slds-resizable__divider"></span>
                                </span>
                            </div>
                        </div>
                    </th>
                    <th class={headClasses} scope="col" style={fixedWidth} tabindex="-1">
                        <div class="slds-cell-fixed" style={fixedWidth}>
                            <div class="slds-th__action slds-text-link--reset">
                                <span class="slds-truncate" title={labels.lblStatus}>{labels.lblStatus}</span>
                            </div>
                            <div class="slds-resizable">
                                <span class="slds-resizable__handle" onmousedown={handlemousedown}>
                                    <span class="slds-resizable__divider"></span>
                                </span>
                            </div>
                        </div>
                    </th>
                    <th class={headClasses} scope="col" style={fixedWidth} tabindex="-1">
                        <div class="slds-cell-fixed" style={fixedWidth}>
                            <div class="slds-th__action slds-text-link--reset">
                                <span class="slds-truncate" title={labels.firstDonation}>{labels.firstDonation}</span>
                            </div>
                            <div class="slds-resizable">
                                <span class="slds-resizable__handle" onmousedown={handlemousedown}>
                                    <span class="slds-resizable__divider"></span>
                                </span>
                            </div>
                        </div>
                    </th>
                    <th class={headClasses} scope="col" style={fixedWidth} tabindex="-1">
                        <div class="slds-cell-fixed" style={fixedWidth}>
                            <div class="slds-th__action slds-text-link--reset">
                                <span class="slds-truncate" title={labels.finalDonation}>{labels.finalDonation}</span>
                            </div>
                            <div class="slds-resizable">
                                <span class="slds-resizable__handle" onmousedown={handlemousedown}>
                                    <span class="slds-resizable__divider"></span>
                                </span>
                            </div>
                        </div>
                    </th>
                    <th class={headClasses} scope="col" style={fixedWidth} tabindex="-1">
                        <div class="slds-cell-fixed" style={fixedWidth}>
                            <div class="slds-th__action slds-text-link--reset">
                                <span class="slds-truncate"
                                    title={labels.mostRecentDonation}>{labels.mostRecentDonation}</span>
                            </div>
                            <div class="slds-resizable">
                                <span class="slds-resizable__handle" onmousedown={handlemousedown}>
                                    <span class="slds-resizable__divider"></span>
                                </span>
                            </div>
                        </div>
                    </th>
                    <th class={headClasses} scope="col" style={fixedWidth} tabindex="-1">
                        <div class="slds-cell-fixed" style={fixedWidth}>
                            <div class="slds-th__action slds-text-link--reset">
                                <span class="slds-truncate" title={labels.nextDonation}>{labels.nextDonation}</span>
                            </div>
                            <div class="slds-resizable">
                                <span class="slds-resizable__handle" onmousedown={handlemousedown}>
                                    <span class="slds-resizable__divider"></span>
                                </span>
                            </div>
                        </div>
                    </th>
                    <th class={headClasses} scope="col" style={fixedWidth} tabindex="-1">
                        <div class="slds-cell-fixed" style={fixedWidth}>
                            <div class="slds-th__action slds-text-link--reset">
                                <span class="slds-truncate" title={labels.lastModified}>{labels.lastModified}</span>
                            </div>
                            <div class="slds-resizable">
                                <span class="slds-resizable__handle" onmousedown={handlemousedown}>
                                    <span class="slds-resizable__divider"></span>
                                </span>
                            </div>
                        </div>
                    </th>
                    <th scope="col" tabindex="-1">
                        <div class="slds-cell-fixed">
                            <div class="slds-th__action slds-text-link--reset">
                            </div>
                            <div class="slds-truncate slds-assistive-text" title="Actions">Actions</div>
                        </div>
                    </th>
                </tr>
            </thead>
            <tbody>
                <template for:each={data} for:item="item">
                    <tr key={item.recurringDonation.Id} aria-selected="false" class="slds-hint-parent" scope="row">
                        <td key={item.recurringDonation.npe03__Amount__c} data-label={labels.commonAmount} tabindex="-1" aria-label={item.recurringDonation.npe03__Amount__c}>
                            <div class={rowClasses} style={fixedWidth} title={labels.commonAmount}>
                                <lightning-formatted-number value={item.recurringDonation.npe03__Amount__c} format-style="currency"
                                    currency-code="USD"></lightning-formatted-number>
                            </div>
                        </td>
                        <td key={item.frequency} data-label={labels.RDCL_Frequency} tabindex="-1" aria-label={item.frequency}>
                            <div class={rowClasses} style={fixedWidth} title={labels.RDCL_Frequency}>
                                {item.frequency}</div>
                        </td>
                        <td key={item.paymentMethod} data-label={paymentMethod} tabindex="-1" aria-label={item.paymentMethod}>
                            <div class={rowClasses} style={fixedWidth} title={paymentMethod}>
                                {item.paymentMethod}</div>
                        </td>
                        <td key={item.status} data-label={labels.lblStatus} tabindex="-1" aria-label={item.status}>
                            <div class={rowClasses} style={fixedWidth} title={labels.lblStatus}>
                                {item.status}</div>
                        </td>

                        <td key={item.recurringDonation.npe03__Date_Established__c} data-id={item.id} class={tdClasses} data-label={labels.firstDonation} tabindex="-1" aria-label={item.recurringDonation.npe03__Date_Established__c}>
                            <div class={rowClasses} style={fixedWidth} title={labels.firstDonation}>
                                <lightning-formatted-date-time 
                                year="numeric"
                                month="numeric"
                                day="numeric"
                                time-zone={timeZone}
                                value={item.recurringDonation.npe03__Date_Established__c}>
                                </lightning-formatted-date-time>
                            </div>
                        </td>
                        <td key={item.finalDonation} data-id={item.id} class={tdClasses} data-label={labels.finalDonation} tabindex="-1" aria-label={item.finalDonation}>
                            <div class={rowClasses} style={fixedWidth} title={labels.finalDonation}>
                                <lightning-formatted-date-time 
                                year="numeric"
                                month="numeric"
                                day="numeric"
                                time-zone={timeZone}
                                value={item.finalDonation}>
                                </lightning-formatted-date-time>
                            </div>
                        </td>
                        <td key={item.mostRecentDonation} data-id={item.recurringDonation.Id} class={tdClasses} data-label={labels.mostRecentDonation} tabindex="-1" aria-label={item.recurringDonation.npe03__Last_Payment_Date__c}>
                            <div class={rowClasses} style={fixedWidth} title={labels.mostRecentDonation}>
                                <lightning-formatted-date-time 
                                year="numeric"
                                month="numeric"
                                day="numeric"
                                time-zone={timeZone}
                                value={item.recurringDonation.npe03__Last_Payment_Date__c}>
                                </lightning-formatted-date-time>
                            </div>
                        </td>
                        <td key={item.nextDonation} data-id={item.recurringDonation.Id} class={tdClasses}  data-label={labels.nextDonation} tabindex="-1" aria-label={item.nextDonation}>
                            <div class="next-donation" data-ndid={item.recurringDonation.Id} lwc:dom="manual"></div>
                        </td>
                        <td key={item.recurringDonation.LastModifiedDate} data-id={item.recurringDonation.Id} class={tdClasses}  data-label={labels.lastModified} tabindex="-1" aria-label={item.lastModifiedDate}>
                            <div class={rowClasses} style={fixedWidth} title={labels.lastModified}>
                                <lightning-formatted-date-time 
                                year="numeric"
                                month="numeric"
                                day="numeric"
                                time-zone={timeZone}
                                value={item.recurringDonation.LastModifiedDate}>
                                </lightning-formatted-date-time></div>

                        </td>
                        <td data-label={labels.RD2_Actions} tabindex="-1">
                            <lightning-button-menu class="dv-dynamic-mobile" menu-alignment="auto" alternative-text={labels.RD2_Actions}>
                                <template for:each={item.actions} for:item="action">
                                    <p key={action.name} data-recid={action.name}>
                                        <lightning-menu-item label={action.label} onclick={handleRowAction} data-action={action.name} data-recordid={item.recurringDonation.Id} disabled={action.disabled}>
                                        </lightning-menu-item>
                                    </p>
                                </template>
                            </lightning-button-menu>
                        </td>
                        <td class={viewMore} data-label={labels.RD2_ViewMoreDetails} data-viewid={item.recurringDonation.Id} onclick={toggleView}>
                        </td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>
    <c-update-payment-method-modal is-bank-payment-allowed={allowACHPaymentMethod} current-record={currentRecord} open-update-payment-method={openUpdatePaymentMethod} onclose={handleClose}></c-update-payment-method-modal>
    <c-change-amount-or-frequency-modal is-initially-monthly-donation={isInitiallyMonthlyDonation} is-elevate-donation={isElevateDonation} fixed-installments-label={fixedInstallmentsLabel} day-of-month-field-label={dayOfMonthFieldLabel} default-record-type-id={defaultRecordTypeId} current-record={currentRecord} open-change-amount-or-frequency={openChangeAmountOrFrequency} onclose={handleClose}></c-change-amount-or-frequency-modal>
    <c-stop-recurring-donation-modal current-record={currentRecord} open-stop-recurring-donation={openStopRecurringDonation} onclose={handleClose}></c-stop-recurring-donation-modal>
</template>